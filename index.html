<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Company Directory</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main class="container">
    <h1 class="title">Company Directory</h1>

    <label class="sr-only" for="search">Search companies</label>
    <input id="search" class="search" type="text" placeholder="Type company name..." autocomplete="off" />
    <ul id="companyList" class="list hidden" aria-label="Company results"></ul>

    <!-- World clocks -->
    <section id="clocksSection" class="clocks" aria-label="World clocks">
      <div class="clock-card">
        <div class="zone">New York</div>
        <div class="subtime" id="sub-ny"></div>
        <div class="analog-clock" id="clock-ny">
          <div class="numbers"></div>
          <div class="hand hour"></div>
          <div class="hand minute"></div>
          <div class="hand second"></div>
          <div class="center"></div>
        </div>
      </div>
      <div class="clock-card">
        <div class="zone">London</div>
        <div class="subtime" id="sub-lon"></div>
        <div class="analog-clock" id="clock-lon">
          <div class="numbers"></div>
          <div class="hand hour"></div>
          <div class="hand minute"></div>
          <div class="hand second"></div>
          <div class="center"></div>
        </div>
      </div>
      <div class="clock-card">
        <div class="zone">Australia</div>
        <div class="subtime" id="sub-syd"></div>
        <div class="analog-clock" id="clock-syd">
          <div class="numbers"></div>
          <div class="hand hour"></div>
          <div class="hand minute"></div>
          <div class="hand second"></div>
          <div class="center"></div>
        </div>
      </div>
      <div class="clock-card">
        <div class="zone">India</div>
        <div class="subtime" id="sub-ist"></div>
        <div class="analog-clock" id="clock-ist">
          <div class="numbers"></div>
          <div class="hand hour"></div>
          <div class="hand minute"></div>
          <div class="hand second"></div>
          <div class="center"></div>
        </div>
      </div>
    </section>

    <!-- Details -->
    <div id="detailsWrapper">
      <section id="details" class="card" aria-live="polite"></section>
      <div id="disclaimer" class="disclaimer hidden">
        <strong>Disclaimer:</strong>
        The contact details provided here are for reference only and may be subject to change.
        Please verify the latest information directly from the company's official website
        before sharing with customers.
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer id="footer">© 2025 Y Amarjit Singh. All rights reserved.</footer>

  <script defer src="app.js"></script>

  <!-- Firebase Presence (silent tracking, no UI) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, set, onDisconnect, serverTimestamp, update }
      from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    // TODO: paste your real config (Project settings → Your apps → Web)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "company-directory-ea220.firebaseapp.com",
      databaseURL: "https://company-directory-ea220-default-rtdb.firebaseio.com",
      projectId: "company-directory-ea220",
      storageBucket: "company-directory-ea220.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Initialize
    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    // Stable id per BROWSER (so multiple tabs = 1 visitor)
    const id = (() => {
      const k = "presenceId";
      let v = localStorage.getItem(k);
      if (!v) {
        v = (crypto.randomUUID && crypto.randomUUID()) || Math.random().toString(36).slice(2);
        localStorage.setItem(k, v);
      }
      return v;
    })();

    // Write presence and auto-remove on disconnect
    const meRef = ref(db, "presence/" + id);

    await set(meRef, {
      online: true,
      ts: serverTimestamp(),
      ua: navigator.userAgent,
      path: location.pathname
    });

    onDisconnect(meRef).remove();

    // Heartbeat to refresh timestamp while tab stays open (every 60s)
    setInterval(() => {
      update(meRef, { ts: serverTimestamp(), path: location.pathname });
    }, 60_000);
  </script>
</body>
</html>
